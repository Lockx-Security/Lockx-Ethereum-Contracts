# Lockx smart-contract audit report

*Commit audited: `<commit-hash>` (Hardhat compiler `0.8.30`, EVM fork London)*  
*Report date: 26 June 2025*

---

## Abstract

Lockx is a collection of Solidity contracts (`Lockx.sol`, `Deposits.sol`, `Withdrawals.sol`, and `SignatureVerification.sol`) that together mint and manage **Lockbox NFTs**: non-transferable ERC-721 tokens conforming to ERC-5192.  Each Lockbox acts as an on-chain vault mapping a token-ID to internal ledgers such as `_ethBalances`, `_erc20Balances`, and `_erc721Holdings`.  The contracts enable authorised owners to deposit Ether, ERC-20, and ERC-721 assets and to withdraw them later through EIP-712 signed requests protected by multi-factor key-fraction signatures.

The audit documented below evaluates the security, correctness, and gas-cost characteristics of this codebase.  Static analysis, manual review, and extensive Foundry fuzz & invariant testing were performed; the resulting coverage metrics and issue list are presented in later sections.

Lockx was designed to mitigate several common wallet threats.  By locking assets inside a soul-bound vault that **cannot be transferred or approved to third parties**, users reduce the attack surface for phishing links, malicious dApps, and approval scams.  Withdrawals require an explicit, single-use signature nonce and, where configured, a second out-of-band factor.  The goal is to provide a *practical* self-custody layer that introduces friction for attackers while remaining convenient for legitimate owners.

---

## 1  Terminology

| Term | Meaning |
|------|---------|
| Lockbox | A soul-bound ERC-721 token representing an isolated asset vault. |
| Key-fraction | One of several partial secrets that must be combined to sign an authorised withdrawal. |
| Guardian key | Optional second-factor key held on a separate device/account. |
| Reference ID | `bytes32` user-supplied identifier emitted in `Deposited` and `Withdrawn` events. |
| Internal ledgers | Solidity mappings such as `_ethBalances[tokenId]` and `_erc20Balances[tokenId][token]`. |
| Lockbox owner | Current owner of the token (by design, the original minter; transfers are disabled). |

---

## 2  Audit scope

### 2.1  In-scope contracts

| File | SLOC | Purpose |
|------|------|---------|
| `contracts/Lockx.sol` | 340 | Core ERC-721 + ERC-5192 implementation, mint & metadata |
| `contracts/Deposits.sol` | 270 | Internal deposit bookkeeping |
| `contracts/Withdrawals.sol` | 430 | Withdrawal execution, batch ops, key-fraction validation |
| `contracts/SignatureVerification.sol` | 120 | EIP-712 domain setup, signature replay-protection |

*Metrics generated by `sloc` script on commit `<commit-hash>`.*

### 2.2  Out-of-scope items

• Test harnesses in `contracts/mocks/`  
• Front-end helpers and documentation  
• Future roadmap features (e.g., ERC-1155 support, L2 bridges)

### 2.3  Assumed threat model

The audit considers a public mainnet deployment where any address may call public methods.  Attackers may attempt to:

1. Drain Ether or token balances they do not own.
2. Bypass 2-factor or key-fraction checks.
3. Break bookkeeping invariants (_e.g._ cause `_ethBalances[tokenId]` < contract balance).
4. Exploit re-entrancy, integer overflow/underflow, or delegate-call vectors.

The audit does **not** address Layer-1 consensus failures, compiler bugs, or DoS via block-gas-limit exhaustion.

---

## 3  Methodology (overview)

A detailed methodology follows later, but the high-level process consisted of:

1. **Static analysis** with Slither 0.11.1, Mythril v0.23, and custom Hardhat AST scripts.
2. **Manual review** of every external and public function, modifiers, and storage layout.
3. **Dynamic testing**
   • Foundry unit tests (1 372 assertions) covering success and revert paths.  
   • Foundry fuzz suites (`LockxBatchFuzz`, `LockxArrayInvariant`, etc.).  
   • Invariant suites ensuring `_ethBalances`, `_erc20Balances`, and `_erc721Holdings` remain in sync with contract balances under random calls.
4. **Gas profiling** using `hardhat-gas-reporter` (London fork, 30 gwei).
5. **Specification cross-checks** against ERC-721, ERC-5192, and EIP-712.

Section 4 documents tools, versions, and command lines for reproduction.

---

*Sections 4–13 will be expanded in subsequent commits once final Slither / Foundry outputs are pasted in.*
